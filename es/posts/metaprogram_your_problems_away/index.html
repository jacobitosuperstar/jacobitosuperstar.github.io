<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN crossorigin=anonymous><link href=//jacobobedoya.com/css/main.min.fdab6cf2d7feda06308d57d2ae5622a83a9852053cf73f19674bead9c36a1b8c.css rel=stylesheet><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700;900&display=swap" rel=stylesheet><link rel="shortcut icon" href=//jacobobedoya.com/favicon/favicon-310.0527484c8987eb011a0aaa843c590be2887b5e7f3b59e22677664aceac0b0b88.png><link rel=icon type=image/png href=//jacobobedoya.com/favicon/favicon-310.0527484c8987eb011a0aaa843c590be2887b5e7f3b59e22677664aceac0b0b88.png><link rel=apple-touch-icon type=image/png href=//jacobobedoya.com/favicon/favicon-310.0527484c8987eb011a0aaa843c590be2887b5e7f3b59e22677664aceac0b0b88.png><meta name=msapplication-config content="favicon/browserconfig.xml"><title>jacobitosuperstar
</title><meta name=description content="Personal page for my blog, CV and other posts that I wish to share in the page"></head><body><header id=header class=site-header role=banner><nav class="navbar navbar-expand-md navbar-dark justify-content-center fixed-top" style=background-color:#000><div class=container><a href=//jacobobedoya.com/es/ class="navbar-brand nav-link text-wrap" style=color:salmon onmouseover='this.style.color="red"' onmouseout='this.style.color="salmon"'><b>jacobitosuperstar</b>
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarToggler aria-controls=navbarToggler aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarToggler><ul class="navbar-nav nav-justified w-100 text-center" style=vertical-align:middle;text-transform:uppercase><li class=nav-item><div class=container><a href=//jacobobedoya.com/es/posts/ class="navbar-brand nav-link text-wrap" style=color:pink onmouseover='this.style.color="salmon"' onmouseout='this.style.color="pink"'><b>POSTS</b></a></div></li><li class=nav-item><div class=container><a href=//jacobobedoya.com/es/stories/ class="navbar-brand nav-link text-wrap" style=color:pink onmouseover='this.style.color="salmon"' onmouseout='this.style.color="pink"'><b>HISTORIAS</b></a></div></li><li class=nav-item><div class=container><a href=//jacobobedoya.com/es/about_me/ class="navbar-brand nav-link text-wrap" style=color:pink onmouseover='this.style.color="salmon"' onmouseout='this.style.color="pink"'><b>ACERCA DE M√ç</b></a></div></li><li class=nav-item><div class=container><a href=//jacobobedoya.com/es/cv/ class="navbar-brand nav-link text-wrap" style=color:pink onmouseover='this.style.color="salmon"' onmouseout='this.style.color="pink"'><b>CV</b></a></div></li><li class=nav-item><div class=container><div class=dropdown><button class="btn btn-secondary dropdown-toggle" type=button data-bs-toggle=dropdown aria-expanded=false>
es</button><ul class=dropdown-menu><li><a href=//jacobobedoya.com/en/posts/metaprogram_your_problems_away/ class=dropdown-item>English</a></li></ul></div></div></li></ul></div></div></nav></header><main><div class=container><h1 style=text-align:left;text-transform:uppercase>Metaprogram your problems away</h1><p style=text-align:justify><p>Metaprogramming is a useful tool when you want to incorporate general behavior
into your program without having to add extensive boilerplate code throughout
it. This practice is typically employed by individuals who create frameworks or
development tools. The idea behind metaprogramming is to provide you with an
initial insight into how such tasks are accomplished, hopefully inspiring ideas
for future design projects.</p><p>To make sense of all the concepts discussed here, you should be using Python
version 3.6 or later and have a basic understanding of decorators, functions,
and classes. In the case we&rsquo;re studying, we will log the names of functions
called within an existing Python program.</p><p>Logging is a way to record messages from our program, including errors,
warnings, information, or debugging messages that can be placed at various
points in the code. In Python, this is straightforward. We can create a logger
class from the logging module to stream our messages to the console, like the
one shown below.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#b6a0ff>import</span> logging
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#b6a0ff>class</span> ConsoleLogger:
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> __init__(
</span></span><span style=display:flex><span>        self,
</span></span><span style=display:flex><span>        name: <span style=color:#f78fe7>str</span> <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;default_logger&#34;</span>,
</span></span><span style=display:flex><span>        level:<span style=color:#f78fe7>str</span> <span style=color:#00d3d0>=</span> <span style=color:#79a8ff>&#34;DEBUG&#34;</span>
</span></span><span style=display:flex><span>    ):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          accepted_values <span style=color:#00d3d0>=</span> [
</span></span><span style=display:flex><span>              <span style=color:#79a8ff>&#34;DEBUG&#34;</span>,
</span></span><span style=display:flex><span>              <span style=color:#79a8ff>&#34;INFO&#34;</span>,
</span></span><span style=display:flex><span>              <span style=color:#79a8ff>&#34;WARNING&#34;</span>,
</span></span><span style=display:flex><span>              <span style=color:#79a8ff>&#34;ERROR&#34;</span>,
</span></span><span style=display:flex><span>              <span style=color:#79a8ff>&#34;CRITICAL&#34;</span>
</span></span><span style=display:flex><span>          ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#b6a0ff>if</span> level <span style=color:#00d3d0>not</span> <span style=color:#00d3d0>in</span> accepted_values:
</span></span><span style=display:flex><span>              <span style=color:#b6a0ff>raise</span> ValueError(
</span></span><span style=display:flex><span>                  <span style=color:#79a8ff>&#34;The value given to the variable is not an accepted value.&#34;</span>
</span></span><span style=display:flex><span>              )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          logging_level <span style=color:#00d3d0>=</span> {
</span></span><span style=display:flex><span>              <span style=color:#79a8ff>&#34;DEBUG&#34;</span>: logging<span style=color:#00d3d0>.</span>DEBUG,
</span></span><span style=display:flex><span>              <span style=color:#79a8ff>&#34;INFO&#34;</span>: logging<span style=color:#00d3d0>.</span>INFO,
</span></span><span style=display:flex><span>              <span style=color:#79a8ff>&#34;WARNING&#34;</span>: logging<span style=color:#00d3d0>.</span>WARNING,
</span></span><span style=display:flex><span>              <span style=color:#79a8ff>&#34;ERROR&#34;</span>: logging<span style=color:#00d3d0>.</span>ERROR,
</span></span><span style=display:flex><span>              <span style=color:#79a8ff>&#34;CRITICAL&#34;</span>: logging<span style=color:#00d3d0>.</span>CRITICAL,
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          self<span style=color:#00d3d0>.</span>logger <span style=color:#00d3d0>=</span> logging<span style=color:#00d3d0>.</span>getLogger(name)
</span></span><span style=display:flex><span>          self<span style=color:#00d3d0>.</span>logger<span style=color:#00d3d0>.</span>setLevel(logging_level[level])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          console_handler <span style=color:#00d3d0>=</span> logging<span style=color:#00d3d0>.</span>StreamHandler()
</span></span><span style=display:flex><span>          console_handler<span style=color:#00d3d0>.</span>setLevel(logging_level[level])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          formatter <span style=color:#00d3d0>=</span> logging<span style=color:#00d3d0>.</span>Formatter(
</span></span><span style=display:flex><span>              <span style=color:#79a8ff>&#39;</span><span style=color:#79a8ff>%(asctime)s</span><span style=color:#79a8ff> - </span><span style=color:#79a8ff>%(levelname)s</span><span style=color:#79a8ff> - </span><span style=color:#79a8ff>%(message)s</span><span style=color:#79a8ff>&#39;</span>
</span></span><span style=display:flex><span>          )
</span></span><span style=display:flex><span>          console_handler<span style=color:#00d3d0>.</span>setFormatter(formatter)
</span></span><span style=display:flex><span>          self<span style=color:#00d3d0>.</span>logger<span style=color:#00d3d0>.</span>addHandler(console_handler)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> <span style=color:#feacd0>debug</span>(self, message):
</span></span><span style=display:flex><span>        self<span style=color:#00d3d0>.</span>logger<span style=color:#00d3d0>.</span>debug(message)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> <span style=color:#feacd0>info</span>(self, message):
</span></span><span style=display:flex><span>        self<span style=color:#00d3d0>.</span>logger<span style=color:#00d3d0>.</span>info(message)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> <span style=color:#feacd0>warning</span>(self, message):
</span></span><span style=display:flex><span>        self<span style=color:#00d3d0>.</span>logger<span style=color:#00d3d0>.</span>warning(message)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> <span style=color:#feacd0>error</span>(self, message):
</span></span><span style=display:flex><span>        self<span style=color:#00d3d0>.</span>logger<span style=color:#00d3d0>.</span>error(message)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> <span style=color:#feacd0>critical</span>(self, message):
</span></span><span style=display:flex><span>        self<span style=color:#00d3d0>.</span>logger<span style=color:#00d3d0>.</span>critical(message)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#b6a0ff>if</span> __name__ <span style=color:#00d3d0>==</span> <span style=color:#79a8ff>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    logger <span style=color:#00d3d0>=</span> ConsoleLogger()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    logger<span style=color:#00d3d0>.</span>debug(<span style=color:#79a8ff>&#34;This is a debug message.&#34;</span>)
</span></span><span style=display:flex><span>    logger<span style=color:#00d3d0>.</span>info(<span style=color:#79a8ff>&#34;This is an info message.&#34;</span>)
</span></span><span style=display:flex><span>    logger<span style=color:#00d3d0>.</span>warning(<span style=color:#79a8ff>&#34;This is a warning message.&#34;</span>)
</span></span><span style=display:flex><span>    logger<span style=color:#00d3d0>.</span>error(<span style=color:#79a8ff>&#34;This is an error message.&#34;</span>)
</span></span><span style=display:flex><span>    logger<span style=color:#00d3d0>.</span>critical(<span style=color:#79a8ff>&#34;This is a critical message.&#34;</span>)
</span></span></code></pre></div><p>and just to apply it to the parts of the code that we want to log, we write the
logging statements.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#b6a0ff>class</span> Operations:
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> __init__(x, y):
</span></span><span style=display:flex><span>        self<span style=color:#00d3d0>.</span>x <span style=color:#00d3d0>=</span> x
</span></span><span style=display:flex><span>        self<span style=color:#00d3d0>.</span>y <span style=color:#00d3d0>=</span> y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> <span style=color:#feacd0>add</span>(self):
</span></span><span style=display:flex><span>        logger<span style=color:#00d3d0>.</span>debug(<span style=color:#79a8ff>&#34;add&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#b6a0ff>return</span> self<span style=color:#00d3d0>.</span>x <span style=color:#00d3d0>+</span> self<span style=color:#00d3d0>.</span>y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> <span style=color:#feacd0>subtract</span>(self):
</span></span><span style=display:flex><span>        logger<span style=color:#00d3d0>.</span>debug(<span style=color:#79a8ff>&#34;subtract&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#b6a0ff>return</span> self<span style=color:#00d3d0>.</span>x <span style=color:#00d3d0>-</span> self<span style=color:#00d3d0>.</span>y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> <span style=color:#feacd0>multiply</span>(self):
</span></span><span style=display:flex><span>        logger<span style=color:#00d3d0>.</span>debug(<span style=color:#79a8ff>&#34;multiply&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#b6a0ff>return</span> self<span style=color:#00d3d0>.</span>x <span style=color:#00d3d0>*</span> self<span style=color:#00d3d0>.</span>y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> <span style=color:#feacd0>divide</span>(self):
</span></span><span style=display:flex><span>        logger<span style=color:#00d3d0>.</span>debug(<span style=color:#79a8ff>&#34;divide&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#b6a0ff>return</span> self<span style=color:#00d3d0>.</span>x <span style=color:#00d3d0>/</span> self<span style=color:#00d3d0>.</span>y
</span></span></code></pre></div><p>The issue we aim to address is the need to insert a logging statement into each
section of the code that requires logging. This type of code repetition is
precisely where Metaprogramming shines.</p><p>Our initial encounter with metaprogramming in Python comes through the
utilization of decorators. Decorators are functions that take other functions
as arguments and enable you to execute code between function calls. You&rsquo;ll
often encounter them in popular frameworks like Django and Flask. In our case,
we will leverage decorators to log the names of the functions we call within a
DEBUG message.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#b6a0ff>from</span> typing <span style=color:#b6a0ff>import</span> Optional, Callable
</span></span><span style=display:flex><span><span style=color:#b6a0ff>from</span> functools <span style=color:#b6a0ff>import</span> wraps, partial
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#b6a0ff>def</span> <span style=color:#feacd0>name_logging_function</span>(
</span></span><span style=display:flex><span>    function: Optional[Callable] <span style=color:#00d3d0>=</span> <span style=color:#00bcff>None</span>,
</span></span><span style=display:flex><span>    logger_name: Optional[<span style=color:#f78fe7>str</span>] <span style=color:#00d3d0>=</span> <span style=color:#00bcff>None</span>,
</span></span><span style=display:flex><span>    logging_level: Optional[<span style=color:#f78fe7>str</span>] <span style=color:#00d3d0>=</span> <span style=color:#00bcff>None</span>,
</span></span><span style=display:flex><span>) <span style=color:#00d3d0>-&gt;</span> Callable:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>if</span> function <span style=color:#00d3d0>is</span> <span style=color:#00bcff>None</span>:
</span></span><span style=display:flex><span>        <span style=color:#b6a0ff>return</span> partial(
</span></span><span style=display:flex><span>          name_logging_function,
</span></span><span style=display:flex><span>          logger_name<span style=color:#00d3d0>=</span>logger_name,
</span></span><span style=display:flex><span>          logging_level<span style=color:#00d3d0>=</span>logging_level
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> <span style=color:#feacd0>decorator</span>(function):
</span></span><span style=display:flex><span>        @wraps(function)
</span></span><span style=display:flex><span>        <span style=color:#b6a0ff>def</span> <span style=color:#feacd0>wrapper</span>(<span style=color:#00d3d0>*</span>args, <span style=color:#00d3d0>**</span>kwargs):
</span></span><span style=display:flex><span>            logger <span style=color:#00d3d0>=</span> ConsoleLogger(
</span></span><span style=display:flex><span>                name<span style=color:#00d3d0>=</span>logging_name,
</span></span><span style=display:flex><span>                level<span style=color:#00d3d0>=</span>logging_level,
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>            logger<span style=color:#00d3d0>.</span>debug(<span style=color:#79a8ff>f</span><span style=color:#79a8ff>&#34;</span><span style=color:#79a8ff>{</span>function<span style=color:#00d3d0>.</span>__qualname__<span style=color:#79a8ff>}</span><span style=color:#79a8ff>&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#b6a0ff>return</span> function(<span style=color:#00d3d0>*</span>args, <span style=color:#00d3d0>**</span>kwargs)
</span></span><span style=display:flex><span>        <span style=color:#b6a0ff>return</span> wrapper
</span></span></code></pre></div><p>This is how we apply the decorator we just wrote to the various methods of the
class. However, as you will notice, we haven&rsquo;t completely achieved our goal
yet. The logging code remains isolated to a single location (where the
decorator is applied). Nonetheless, it simplifies the process for users because
they don&rsquo;t need to concern themselves with how to use the decorator; they can
simply place it in the function where it&rsquo;s needed.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#b6a0ff>class</span> Operations:
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> __init__(x, y):
</span></span><span style=display:flex><span>        self<span style=color:#00d3d0>.</span>x <span style=color:#00d3d0>=</span> x
</span></span><span style=display:flex><span>        self<span style=color:#00d3d0>.</span>y <span style=color:#00d3d0>=</span> y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    @name_logging_function
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> <span style=color:#feacd0>add</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#b6a0ff>return</span> self<span style=color:#00d3d0>.</span>x <span style=color:#00d3d0>+</span> self<span style=color:#00d3d0>.</span>y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    @name_logging_function
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> <span style=color:#feacd0>subtract</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#b6a0ff>return</span> self<span style=color:#00d3d0>.</span>x <span style=color:#00d3d0>-</span> self<span style=color:#00d3d0>.</span>y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    @name_logging_function
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> <span style=color:#feacd0>multiply</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#b6a0ff>return</span> self<span style=color:#00d3d0>.</span>x <span style=color:#00d3d0>*</span> self<span style=color:#00d3d0>.</span>y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    @name_logging_function
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> <span style=color:#feacd0>divide</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#b6a0ff>return</span> self<span style=color:#00d3d0>.</span>x <span style=color:#00d3d0>/</span> self<span style=color:#00d3d0>.</span>y
</span></span></code></pre></div><p>To further streamline the process of logging the names of called functions, we
will employ Class Decorators. A class decorator involves applying a decorator
to a class definition, enabling us to apply the function decorator to all
methods within the class.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#b6a0ff>def</span> <span style=color:#feacd0>name_logging_class</span>(cls):
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>for</span> name, value <span style=color:#00d3d0>in</span> <span style=color:#f78fe7>vars</span>(cls)<span style=color:#00d3d0>.</span>items():
</span></span><span style=display:flex><span>        <span style=color:#b6a0ff>if</span> callable(value):
</span></span><span style=display:flex><span>            <span style=color:#f78fe7>setattr</span>(cls, name, name_logging_function(value))
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>return</span> cls
</span></span></code></pre></div><p>With this code, our approach involves receiving a class definition (cls), from
which we retrieve the class dictionary. We then iterate through it, checking
whether the value is a function. If it is, we apply the function decorator to
it and subsequently reset the decorated method back into the class.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span>@name_logging_class
</span></span><span style=display:flex><span><span style=color:#b6a0ff>class</span> Operations:
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> __init__(x, y):
</span></span><span style=display:flex><span>        self<span style=color:#00d3d0>.</span>x <span style=color:#00d3d0>=</span> x
</span></span><span style=display:flex><span>        self<span style=color:#00d3d0>.</span>y <span style=color:#00d3d0>=</span> y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> <span style=color:#feacd0>add</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#b6a0ff>return</span> self<span style=color:#00d3d0>.</span>x <span style=color:#00d3d0>+</span> self<span style=color:#00d3d0>.</span>y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> <span style=color:#feacd0>subtract</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#b6a0ff>return</span> self<span style=color:#00d3d0>.</span>x <span style=color:#00d3d0>-</span> self<span style=color:#00d3d0>.</span>y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> <span style=color:#feacd0>multiply</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#b6a0ff>return</span> self<span style=color:#00d3d0>.</span>x <span style=color:#00d3d0>*</span> self<span style=color:#00d3d0>.</span>y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> <span style=color:#feacd0>divide</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#b6a0ff>return</span> self<span style=color:#00d3d0>.</span>x <span style=color:#00d3d0>/</span> self<span style=color:#00d3d0>.</span>y
</span></span></code></pre></div><p>The limitations of this decorator application are evident when it comes to
class methods and static methods. These methods won&rsquo;t be affected because they
are not callables; they are descriptor objects. The only way a decorator would
function with these methods is if we apply it as demonstrated below, which
differs from how the decorator is currently being applied.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#b6a0ff>class</span> Operations:
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> __init__(x, y):
</span></span><span style=display:flex><span>        self<span style=color:#00d3d0>.</span>x <span style=color:#00d3d0>=</span> x
</span></span><span style=display:flex><span>        self<span style=color:#00d3d0>.</span>y <span style=color:#00d3d0>=</span> y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    @classmethod
</span></span><span style=display:flex><span>    @name_logging_function
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> <span style=color:#feacd0>add</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#b6a0ff>return</span> self<span style=color:#00d3d0>.</span>x <span style=color:#00d3d0>+</span> self<span style=color:#00d3d0>.</span>y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    @staticmethod
</span></span><span style=display:flex><span>    @name_logging_function
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> <span style=color:#feacd0>add</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#b6a0ff>return</span> self<span style=color:#00d3d0>.</span>x <span style=color:#00d3d0>+</span> self<span style=color:#00d3d0>.</span>y
</span></span></code></pre></div><p>Although things are looking cleaner now, code repetition can still become an
issue when our program contains numerous classes. Additionally, class
decorators suffer from the same limitations we sought to overcome earlier: they
remain isolated to the location where they are applied. If our program has many
classes, we&rsquo;d need to go through each one and decorate them individually to
give them this behavior.</p><p>So, what&rsquo;s the solution to make these decorators more broadly applicable? The
answer is straightforward: we need to create a metaclass. By creating a
metaclass from which our classes will be derived, we can change the way classes
are constructed.</p><p>To understand this concept, it&rsquo;s important to know that all classes and objects
in Python are instances of <code>type</code>. Python has a type system, and everything
inherits from <code>type</code>. This implies that, since all classes are instances of
<code>type</code>, there must be a base class of <code>type</code> responsible for creating instances
of <code>type</code> somewhere in the Python system.</p><pre tabindex=0><code class=language-log data-lang=log>
&gt;&gt;&gt; x = 1
&gt;&gt;&gt; type(x)
&lt;class &#39;int&#39;&gt;

&gt;&gt;&gt; class A:
...   ...
...
&gt;&gt;&gt; type(A)
&lt;class &#39;type&#39;&gt;

&gt;&gt;&gt; isinstante(Operations, type)
True&gt;&gt;&gt; x = 1
&gt;&gt;&gt; type(x)
&lt;class &#39;int&#39;&gt;

&gt;&gt;&gt; class A:
...   ...
...
&gt;&gt;&gt; type(A)
&lt;class &#39;type&#39;&gt;

&gt;&gt;&gt; isinstante(Operations, type)
True
</code></pre><p>The way a class is constructed in Python, is by having the name of the class,
the bases of the class (classes from which our class inherits), and the
dictionary that composes the class (dictionary with all methods and
attributes), and throw all that into <code>type</code>.</p><pre tabindex=0><code class=language-log data-lang=log>
Operations = type(&#34;Operations&#34;, (), clsdict)

# empty class
&gt;&gt;&gt; A = type(&#34;A&#34;, (), {})
</code></pre><p>So, what happens if we don‚Äôt want to use <code>type</code> as our constructor, what
happens when we want to create something with a different kind of <code>type</code>. We
can use the metaclass keyword argument in our class definition.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#b6a0ff>class</span> Operations(metaclass<span style=color:#00d3d0>=</span><span style=color:#f78fe7>type</span>):
</span></span><span style=display:flex><span>    <span style=color:#00d3d0>...</span>
</span></span></code></pre></div><p>To define a Metaclass we typically create a class that inherits directly from
<code>type</code> and redefine the <code>__new__</code> method. The <code>__new__</code> method is the first
method run in the creation of an object of a class, and is responsible for
creating the and returning the new class instance.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#b6a0ff>class</span> name_logging_metaclass(<span style=color:#f78fe7>type</span>):
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> __new__(cls, clsname, bases, clsdict):
</span></span><span style=display:flex><span>        clsobj <span style=color:#00d3d0>=</span> <span style=color:#f78fe7>super</span>()<span style=color:#00d3d0>.</span>__new__(cls, clsname, bases, clsdict)
</span></span><span style=display:flex><span>        clsobj <span style=color:#00d3d0>=</span> name_logging_class(clsobj)
</span></span><span style=display:flex><span>        <span style=color:#b6a0ff>return</span> clsobj
</span></span></code></pre></div><p>Here we are redefining the <code>__new__</code> method of the metaclass, by creating a new
class object from <code>type</code>, and returning that class object with the class
decorator applied to it, finally propagating that decorator functionality down
hierarchies. And with this, we just changed the basic behavior of our program,
without having to go into every definition and add the logging statement.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#b6a0ff>class</span> Base(metaclass<span style=color:#00d3d0>=</span>name_logging_metaclass):
</span></span><span style=display:flex><span>    <span style=color:#00d3d0>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#b6a0ff>class</span> Operations(Base):
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> __init__(x, y):
</span></span><span style=display:flex><span>        self<span style=color:#00d3d0>.</span>x <span style=color:#00d3d0>=</span> x
</span></span><span style=display:flex><span>        self<span style=color:#00d3d0>.</span>y <span style=color:#00d3d0>=</span> y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> <span style=color:#feacd0>add</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#b6a0ff>return</span> self<span style=color:#00d3d0>.</span>x <span style=color:#00d3d0>+</span> self<span style=color:#00d3d0>.</span>y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> <span style=color:#feacd0>subtract</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#b6a0ff>return</span> self<span style=color:#00d3d0>.</span>x <span style=color:#00d3d0>-</span> self<span style=color:#00d3d0>.</span>y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> <span style=color:#feacd0>multiply</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#b6a0ff>return</span> self<span style=color:#00d3d0>.</span>x <span style=color:#00d3d0>*</span> self<span style=color:#00d3d0>.</span>y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#b6a0ff>def</span> <span style=color:#feacd0>divide</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#b6a0ff>return</span> self<span style=color:#00d3d0>.</span>x <span style=color:#00d3d0>/</span> self<span style=color:#00d3d0>.</span>y
</span></span></code></pre></div><p>There are a lot of problems that you may encounter by trying to do this, for
one, the complexity of the program rises dramatically, which is not something
that the project manager or other members of the team want to deal with, also,
debugging this type of code can also become really complicated in the case we
are adding something more significant than just printing function names into
the console, like working with the <code>__prepare__</code> method or the use of non local
variables across the project without any imports.</p><p>At the end of the day, there&rsquo;s nothing inherently wrong with keeping code
simple. However, I firmly believe that there&rsquo;s immense value in individuals
understanding and being able to apply these techniques when the need arises.
Take the example we&rsquo;ve discussed ‚Äì it&rsquo;s one that can be easily presented.
Instead of going around instructing every programmer to manually add console
logging to each function they write, consider incorporating these decorators or
base classes into the core of the program. This way, the desired functionality
can effortlessly propagate throughout the project.</p></p><b>Tags:</b>
python, metaprogramming</div></main><footer class="footer mt-auto py-3 fixed-bottom"><div class=container-fluid style=text-align:center><div class="d-flex gap-4 justify-content-center"><a href=mailto:jacobobedoya@gmail.com style=text-decoration:none><svg style="height:2rem;width:auto" fill="#000" class="bi bi-mailbox" viewBox="0 0 16 16"><path d="M4 4A3 3 0 001 7v6h6V7A3 3 0 004 4zm0-1h8a4 4 0 014 4v6a1 1 0 01-1 1H1a1 1 0 01-1-1V7a4 4 0 014-4zm2.646 1A3.99 3.99.0 018 7v6h7V7a3 3 0 00-3-3H6.646z"/><path d="M11.793 8.5H9v-1h5a.5.5.0 01.5.5v1a.5.5.0 01-.5.5h-1a.5.5.0 01-.354-.146l-.853-.854zM5 7c0 .552-.448.0-1 0s-1 .552-1 0a1 1 0 012 0z"/></svg>
</a><a href=https://www.instagram.com/jacobitosuperstar/ style=text-decoration:none><svg style="height:1.5rem;width:auto" class="bi bi-instagram" viewBox="0 0 16 16" fill="#00fa9a" onmouseover="this.style.fill='mediumturquoise'" onmouseout="this.style.fill='mediumspringgreen'"><path d="M8 0C5.829.0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.917 3.917.0 00-1.417.923A3.927 3.927.0 00.42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555.0 5.827.0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.916 3.916.0 001.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.926 3.926.0 00-.923-1.417A3.911 3.911.0 0013.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172.0 7.998.0h.003zm-.717 1.442h.718c2.136.0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599s.453.546.598.92c.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.47 2.47.0 01-.599.919c-.28.28-.546.453-.92.598-.28.11-.704.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.478 2.478.0 01-.92-.598 2.48 2.48.0 01-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233.0-2.136.008-2.388.046-3.231.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92.28-.28.546-.453.92-.598.282-.11.705-.24 1.485-.276.738-.034 1.024-.044 2.515-.045v.002zm4.988 1.328a.96.96.0 100 1.92.96.96.0 000-1.92zm-4.27 1.122a4.109 4.109.0 100 8.217 4.109 4.109.0 000-8.217zm0 1.441a2.667 2.667.0 110 5.334 2.667 2.667.0 010-5.334z"/></svg>
</a><a href=https://github.com/jacobitosuperstar style=text-decoration:none><svg style="height:1.5rem;width:auto" class="bi bi-github" viewBox="0 0 16 16" fill="#00fa9a" onmouseover="this.style.fill='mediumturquoise'" onmouseout="this.style.fill='mediumspringgreen'"><path d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.012 8.012.0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
</a><a href=https://www.linkedin.com/in/jacobo-mateo-bedoya-oquendo-233a46202/ style=text-decoration:none><svg style="height:1.5rem;width:auto" class="bi bi-linkedin" viewBox="0 0 16 16" fill="#00fa9a" onmouseover="this.style.fill='mediumturquoise'" onmouseout="this.style.fill='mediumspringgreen'"><path d="M0 1.146C0 .513.526.0 1.175.0h13.65C15.474.0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487.0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837.0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822.0-1.359.54-1.359 1.248.0.694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869.0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274.0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54.0 01.016-.025V6.169h-2.4c.03.678.0 7.225.0 7.225h2.4z"/></svg></a></div></div></footer><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js integrity=sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js integrity=sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r crossorigin=anonymous></script></body></html>